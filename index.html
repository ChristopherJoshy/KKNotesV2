<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="KTU Computer Science Notes and Study Materials">
    <meta name="application-name" content="KKNotes">
    <meta name="apple-mobile-web-app-title" content="KKNotes">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="msapplication-tap-highlight" content="no">
    <title>KKNotes - KTU Computer Science Notes</title>
    
    <!-- PWA -->
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./assets/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./assets/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./assets/icons/icon-512x512.png">
    <link rel="mask-icon" href="./assets/logo.svg" color="#6366f1">
    
    <!-- CSS Styles -->
    <link rel="stylesheet" href="css/newstyle.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/wizard-loader.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Markdown Support -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.5/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="assets/logo.svg" type="image/svg+xml">
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <!-- Site Auth Overlay -->
    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-card">
            <div class="auth-header">
                <img src="assets/logo.svg" alt="KKNotes Logo" class="logo">
                <h1>KKNotes</h1>
            </div>
            <h2>Welcome to KKNotes! <span class="emoji">üëã</span></h2>
            <p>Please sign in with your Google account to access notes, videos, and chat with other students.</p>
            
            <div class="auth-message-container">
                <div class="form-message" id="auth-message"></div>
            </div>
            
            <button id="site-auth-btn" class="google-btn">
                <i class="fab fa-google"></i> Sign in with Google
            </button>
            
            <div class="auth-footer">
                <p>Made with <span class="emoji">‚ù§Ô∏è</span> by Christopher Joshy</p>
            </div>
        </div>
    </div>
    
    <header>
        <nav>
            <div class="logo-container">
                <img src="assets/logo.svg" alt="KKNotes Logo" class="logo">
                <h1>KKNotes</h1>
            </div>
            <div class="nav-links">
                <a href="#home" class="active">Home</a>
                <a href="#notes">Notes</a>
                <a href="#videos">Videos</a>
                <a href="#chat">Chat</a>
                <a href="#about">About</a>
                <a href="admin.html" class="admin-link">
                    <i class="fas fa-lock"></i> Admin
                </a>
            </div>
            <div class="nav-actions">
                <div id="user-profile" class="user-profile hidden">
                    <img src="assets/avatars/default-avatar.png" alt="User" id="user-avatar">
                    <div class="user-dropdown">
                        <div id="user-info" class="user-info">
                            <span id="user-name">User Name</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <button id="logout-btn" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
                <button id="login-btn" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> <span>Sign In</span>
                </button>
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            <button class="menu-toggle" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
        </nav>
    </header>

    <!-- Install Banner -->
    <div id="install-banner" class="install-banner" style="display: none;">
        <div class="install-banner-content">
            <div class="install-banner-icon">
                <i class="fas fa-download"></i>
            </div>
            <div class="install-banner-text">
                <h3>Install KKNotes</h3>
                <p>Get a better experience with our app. Install it to your home screen for quick access.</p>
            </div>
            <div class="install-banner-actions">
                <button id="install-banner-btn" class="install-banner-btn">Install</button>
                <button id="install-banner-dismiss" class="install-banner-dismiss">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <main>
        <section id="home" class="hero">
            <div class="hero-content">
                <h1>Welcome to KKNotes <span class="emoji">üìö</span></h1>
                <p>Your premium resource hub for KTU Computer Science Engineering study materials, featuring high-quality notes and curated video tutorials.</p>
                <a href="#notes" class="btn primary-btn">
                    Explore Notes <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="hero-image">
                <div class="floating-emoji">üß†</div>
                <div class="floating-emoji">üíª</div>
                <div class="floating-emoji">üìù</div>
                <div class="floating-emoji">üéì</div>
            </div>
        </section>

        <section id="notes" class="notes-section">
            <h2>Semester Notes <span class="emoji">üìñ</span></h2>
            <p class="section-desc">
                Access your semester-wise study materials with just one click!
            </p>
            
            <div class="semester-tabs">
                <button class="sem-tab active" data-sem="s1">S1</button>
                <button class="sem-tab" data-sem="s2">S2</button>
                <button class="sem-tab" data-sem="s3">S3</button>
                <button class="sem-tab" data-sem="s4">S4</button>
                <button class="sem-tab" data-sem="s5">S5</button>
                <button class="sem-tab" data-sem="s6">S6</button>
                <button class="sem-tab" data-sem="s7">S7</button>
                <button class="sem-tab" data-sem="s8">S8</button>
            </div>
            
            <div id="notes-container" class="notes-container">
                <div class="loading-spinner">
                    <div class="scene">
                        <div class="objects">
                            <div class="square"></div>
                            <div class="circle"></div>
                            <div class="triangle"></div>
                        </div>
                        <div class="wizard">
                            <div class="body"></div>
                            <div class="right-arm">
                                <div class="right-hand"></div>
                            </div>
                            <div class="left-arm">
                                <div class="left-hand"></div>
                            </div>
                            <div class="head">
                                <div class="beard"></div>
                                <div class="face">
                                    <div class="adds"></div>
                                </div>
                                <div class="hat">
                                    <div class="hat-of-the-hat"></div>
                                    <div class="four-point-star --first"></div>
                                    <div class="four-point-star --second"></div>
                                    <div class="four-point-star --third"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="progress"></div>
                    <div class="noise"></div>
                    <p>Loading notes...</p>
                </div>
            </div>
        </section>
        
        <section id="videos" class="videos-section">
            <h2>Video Tutorials <span class="emoji">üé¨</span></h2>
            <p class="section-desc">
                Watch helpful video tutorials carefully selected for each subject
            </p>
            
            <div class="semester-tabs">
                <button class="sem-tab active" data-sem="s1">S1</button>
                <button class="sem-tab" data-sem="s2">S2</button>
                <button class="sem-tab" data-sem="s3">S3</button>
                <button class="sem-tab" data-sem="s4">S4</button>
                <button class="sem-tab" data-sem="s5">S5</button>
                <button class="sem-tab" data-sem="s6">S6</button>
                <button class="sem-tab" data-sem="s7">S7</button>
                <button class="sem-tab" data-sem="s8">S8</button>
            </div>
            
            <div id="videos-container" class="videos-container">
                <div class="loading-spinner">
                    <div class="scene">
                        <div class="objects">
                            <div class="square"></div>
                            <div class="circle"></div>
                            <div class="triangle"></div>
                        </div>
                        <div class="wizard">
                            <div class="body"></div>
                            <div class="right-arm">
                                <div class="right-hand"></div>
                            </div>
                            <div class="left-arm">
                                <div class="left-hand"></div>
                            </div>
                            <div class="head">
                                <div class="beard"></div>
                                <div class="face">
                                    <div class="adds"></div>
                                </div>
                                <div class="hat">
                                    <div class="hat-of-the-hat"></div>
                                    <div class="four-point-star --first"></div>
                                    <div class="four-point-star --second"></div>
                                    <div class="four-point-star --third"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="progress"></div>
                    <div class="noise"></div>
                    <p>Loading videos...</p>
                </div>
            </div>
        </section>

        <section id="chat" class="chat-section">
            <h2>Global Chat <span class="emoji">üí¨</span></h2>
            <p class="section-desc">
                Connect with other students, share resources, and get help with your courses
            </p>
            
            <div class="chat-container">
                <div class="chat-header">
                    <h3>
                    </h3>
                    <div class="chat-header-actions">
                    </div>
                </div>
                
                <div id="chat-messages" class="chat-messages">
                    <div class="loading-spinner">
                        <div class="scene">
                            <div class="objects">
                                <div class="square"></div>
                                <div class="circle"></div>
                                <div class="triangle"></div>
                            </div>
                            <div class="wizard">
                                <div class="body"></div>
                                <div class="right-arm">
                                    <div class="right-hand"></div>
                                </div>
                                <div class="left-arm">
                                    <div class="left-hand"></div>
                                </div>
                                <div class="head">
                                    <div class="beard"></div>
                                    <div class="face">
                                        <div class="adds"></div>
                                    </div>
                                    <div class="hat">
                                        <div class="hat-of-the-hat"></div>
                                        <div class="four-point-star --first"></div>
                                        <div class="four-point-star --second"></div>
                                        <div class="four-point-star --third"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="progress"></div>
                        <div class="noise"></div>
                        <p>Loading chat...</p>
                    </div>
                </div>
                
                <form id="chat-form" class="chat-form">
                    <div id="chat-user-info" class="chat-user-info"></div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="Type your message..." autocomplete="off">
                        <button type="submit"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </form>
                
                <div class="auth-required-message" id="chat-auth-required">
                    <i class="fas fa-lock"></i>
                    <p>Sign in to participate in the chat</p>
                </div>
            </div>
        </section>
        
        <section id="about" class="about-section">
            <h2>About the Creator <span class="emoji">‚ú®</span></h2>
            <div class="about-content">
                <div class="about-text">
                    <h3>Christopher Joshy</h3>
                    <p class="subtitle">Aspiring Coder | Game Developer in Training | Web Design Enthusiast</p>
                    <p class="about-desc">
                        Currently diving into C# and pursuing my B.Tech in Computer Science at St. Joseph's College of Engineering. 
                        Passionate about creating immersive digital experiences and exploring new technologies. KKNotes is my contribution 
                        to help fellow students access quality study materials with a modern, user-friendly interface.
                    </p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">19</div>
                            <div class="stat-label">Total Stars</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">207</div>
                            <div class="stat-label">Commits</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Total PRs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Contributions</div>
                        </div>
                    </div>

                    <div class="education-section">
                        <h4 class="education-title">
                            <i class="fas fa-graduation-cap"></i>
                            Education
                        </h4>
                        <div class="education-info">
                            <p class="degree">B.Tech in Computer Science</p>
                            <p class="institution">St. Joseph's College of Engineering</p>
                        </div>
                    </div>

                    <div class="languages-section">
                        <div class="language-item">
                            <i class="fab fa-java"></i>
                            Java
                        </div>
                        <div class="language-item">
                            <i class="fab fa-cuttlefish"></i>
                            C#
                        </div>
                        <div class="language-item">
                            <i class="fas fa-code"></i>
                            C++
                        </div>
                        <div class="language-item">
                            <i class="fab fa-python"></i>
                            Python
                        </div>
                        <div class="language-item">
                            <i class="fab fa-html5"></i>
                            HTML5
                        </div>
                        <div class="language-item">
                            <i class="fab fa-css3-alt"></i>
                            CSS3
                        </div>
                        <div class="language-item">
                            <i class="fab fa-js"></i>
                            JavaScript
                        </div>
                        <div class="language-item">
                            <i class="fas fa-gamepad"></i>
                            Unreal Engine
                        </div>
                    </div>

                    <div class="social-links">
                        <a href="https://github.com/ChristopherJoshy" target="_blank" class="social-link">
                            <i class="fab fa-github"></i>
                            GitHub
                        </a>
                        <a href="https://www.instagram.com/calculatederror/" target="_blank" class="social-link">
                            <i class="fab fa-instagram"></i>
                            Instagram
                        </a>
                        <a href="mailto:Christopherjoshy4@gmail.com" class="social-link">
                            <i class="fas fa-envelope"></i>
                            Email
                        </a>
                    </div>
                </div>
                <div class="about-image">
                    <div class="profile-container">
                        <div class="profile-emoji">üë®‚Äçüíª</div>
                        <div class="skill-badge">üéÆ</div>
                        <div class="skill-badge">üíª</div>
                        <div class="skill-badge">üé®</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-database-compat.js"></script>
    <script src="js/env-config.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/github-stats.js"></script>
    
    <!-- Theme toggle fix -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                console.log('Applying direct theme toggle handler');
                themeToggle.addEventListener('click', function() {
                    console.log('Theme toggle clicked (inline handler)');
                    
                    // Get current theme
                    const html = document.documentElement;
                    const currentTheme = html.getAttribute('data-theme') || 'light';
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    // Update HTML attribute
                    html.setAttribute('data-theme', newTheme);
                    
                    // Update body class
                    if (newTheme === 'dark') {
                        document.body.classList.add('dark-mode');
                    } else {
                        document.body.classList.remove('dark-mode');
                    }
                    
                    // Update icon
                    const themeIcon = themeToggle.querySelector('i');
                    if (themeIcon) {
                        if (newTheme === 'dark') {
                            themeIcon.classList.remove('fa-moon');
                            themeIcon.classList.add('fa-sun');
                        } else {
                            themeIcon.classList.remove('fa-sun');
                            themeIcon.classList.add('fa-moon');
                        }
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('theme', newTheme);
                    
                    // Add rotation animation
                    themeToggle.classList.add('rotate');
                    setTimeout(() => {
                        themeToggle.classList.remove('rotate');
                    }, 500);
                });
            }
            
            // Apply system/saved preference on load
            function applyInitialTheme() {
                const savedTheme = localStorage.getItem('theme');
                let initialTheme;
                
                if (savedTheme) {
                    initialTheme = savedTheme;
                } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    initialTheme = 'dark';
                } else {
                    initialTheme = 'light';
                }
                
                // Apply theme
                document.documentElement.setAttribute('data-theme', initialTheme);
                
                if (initialTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    
                    // Update icon
                    const themeIcon = themeToggle ? themeToggle.querySelector('i') : null;
                    if (themeIcon) {
                        themeIcon.classList.remove('fa-moon');
                        themeIcon.classList.add('fa-sun');
                    }
                }
            }
            
            // Apply initial theme immediately
            applyInitialTheme();
        });
    </script>
    
    <!-- Custom Scripts -->
    <script src="js/theme.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/main.js"></script>
    <script src="js/notes.js"></script>
    <script src="js/videos.js"></script>
    <script src="js/chat.js"></script>
    
    <!-- Force styles for cards -->
    <style>
        .notes-grid, .videos-grid {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)) !important;
            gap: 40px !important;
            margin: 30px auto !important;
            width: 100% !important;
            max-width: 1400px !important;
        }
        
        .note-card, .video-card {
            min-height: 450px !important;
            width: 100% !important;
            max-width: 400px !important;
            margin: 0 auto !important;
            border-radius: 20px !important;
            display: flex !important;
            flex-direction: column !important;
            overflow: hidden !important;
            background-color: white !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
            border: 1px solid rgba(99, 102, 241, 0.15) !important;
            position: relative !important;
        }
        
        @media (max-width: 768px) {
            .notes-grid, .videos-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)) !important;
                gap: 30px !important;
            }
        }
        
        @media (max-width: 480px) {
            .notes-grid, .videos-grid {
                grid-template-columns: 1fr !important;
                gap: 25px !important;
            }
        }

        /* Install Banner Styles */
        .install-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #6366f1;
            color: white;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .install-banner-content {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .install-banner-icon {
            font-size: 24px;
            margin-right: 15px;
        }

        .install-banner-text {
            flex: 1;
        }

        .install-banner-text h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .install-banner-text p {
            margin: 5px 0 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .install-banner-actions {
            display: flex;
            align-items: center;
        }

        .install-banner-btn {
            background-color: white;
            color: #6366f1;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-weight: 500;
            cursor: pointer;
            margin-right: 10px;
            transition: background-color 0.2s;
        }

        .install-banner-btn:hover {
            background-color: #f0f0f0;
        }

        .install-banner-dismiss {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .install-banner-dismiss:hover {
            opacity: 1;
        }

        /* Adjust main content when banner is shown */
        body.has-install-banner main {
            margin-top: 60px;
        }

        @media (max-width: 768px) {
            .install-banner-content {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }

            .install-banner-icon {
                margin-right: 0;
                margin-bottom: 10px;
            }

            .install-banner-text {
                margin-bottom: 10px;
            }

            .install-banner-actions {
                width: 100%;
                justify-content: space-between;
            }

            body.has-install-banner main {
                margin-top: 120px;
            }
        }
    </style>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js', {
                        scope: './'
                    });
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                } catch (err) {
                    console.error('ServiceWorker registration failed: ', err);
                }
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        
        // Install Banner Elements
        const installBanner = document.getElementById('install-banner');
        const installBannerBtn = document.getElementById('install-banner-btn');
        const installBannerDismiss = document.getElementById('install-banner-dismiss');

        // Debug function to check PWA status
        function debugPWAStatus() {
            console.log('=== PWA Debug Information ===');
            
            // Check if running in standalone mode
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            console.log('Running in standalone mode:', isStandalone);
            
            // Check if service worker is supported
            console.log('Service Worker supported:', 'serviceWorker' in navigator);
            
            // Check if manifest is loaded
            const manifestLink = document.querySelector('link[rel="manifest"]');
            console.log('Manifest link found:', !!manifestLink);
            if (manifestLink) {
                console.log('Manifest href:', manifestLink.href);
            }
            
            // Check if running on HTTPS
            console.log('Running on HTTPS:', window.location.protocol === 'https:');
            
            // Check if deferredPrompt is available
            console.log('Deferred prompt available:', !!deferredPrompt);
            
            // Check if banner is visible
            console.log('Install banner visible:', installBanner.style.display === 'block');
            
            // Check if running on a mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            console.log('Running on mobile device:', isMobile);
            
            // Check if browser supports PWA installation
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            const isEdge = /Edg/.test(navigator.userAgent);
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            console.log('Browser supports PWA installation:', isChrome || isEdge || isSafari);
            
            console.log('===========================');
        }

        // Function to show install prompt
        function showInstallPrompt() {
            // Check if the app is already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('App is already installed');
                return;
            }
            
            // Show the install banner
            installBanner.style.display = 'block';
            document.body.classList.add('has-install-banner');
            
            // Run debug function
            debugPWAStatus();
        }

        // Show install prompt on page load
        window.addEventListener('load', () => {
            // Delay showing the prompt slightly to ensure the page is fully loaded
            setTimeout(showInstallPrompt, 2000);
        });

        // Capture the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt event fired');
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install banner
            installBanner.style.display = 'block';
            document.body.classList.add('has-install-banner');
            
            // Run debug function
            debugPWAStatus();
        });

        // Handle the install banner button click
        installBannerBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                // Clear the deferredPrompt variable
                deferredPrompt = null;
                // Hide the install banner
                installBanner.style.display = 'none';
                document.body.classList.remove('has-install-banner');
            } else {
                // If no deferred prompt, show a message about manual installation
                alert('To install KKNotes, click the menu button in your browser and select "Add to Home Screen" or "Install KKNotes".');
            }
        });

        // Handle the install banner dismiss button click
        installBannerDismiss.addEventListener('click', () => {
            installBanner.style.display = 'none';
            document.body.classList.remove('has-install-banner');
        });

        window.addEventListener('appinstalled', (evt) => {
            // Log the install event
            console.log('PWA was installed');
            // Hide the install banner
            installBanner.style.display = 'none';
            document.body.classList.remove('has-install-banner');
        });
    </script>
</body>
</html>