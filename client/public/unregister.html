<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Unregister Service Workers</title>
    <meta name="robots" content="noindex" />
    <style>body{font-family:sans-serif;max-width:700px;margin:3rem auto;padding:0 1rem}</style>
  </head>
  <body>
    <h1>Unregistering Service Workersâ€¦</h1>
    <p>This page will unregister all service workers and clear caches for this origin, then redirect back to the app.</p>
    <pre id="log"></pre>
    <script>
      (async function() {
        const log = (m) => { const el = document.getElementById('log'); el.textContent += m + '\n'; };
        try {
          if ('serviceWorker' in navigator) {
            const regs = await navigator.serviceWorker.getRegistrations();
            for (const reg of regs) {
              await reg.unregister();
              log('Unregistered SW: ' + (reg.scope || 'unknown scope'));
            }
          }
          if (window.caches && caches.keys) {
            const keys = await caches.keys();
            for (const key of keys) {
              await caches.delete(key);
              log('Deleted cache: ' + key);
            }
          }
        } catch (e) {
          log('Error: ' + (e && e.message ? e.message : e));
        }
        setTimeout(() => {
          window.location.replace('/?nocache=' + Date.now());
        }, 300);
      })();
    </script>
  </body>
</html>
